clear;clc;
% 数字投影30+20模板
Model_2 = [0.42045,0.60227,0.72727,0.81818,0.625,  0.5,    0.44318,0.43181,0.40909,0.40909,0.38636,0.27272,0.20454,0.19318,0.22727,0.25,   0.27272,0.27272,0.29545,0.31818,0.31818,0.29545,0.27272,0.26136,0.25,  0.23863,0.23863,0.22727,0.21590,0.66148,0.28571,0.42207,0.5,    0.55194,0.55844,0.44805,0.40909,0.38311,0.36363,0.35064,0.34415,0.34415,0.33766,0.35714,0.36363,0.38311,0.40259,0.56493,0.64935,0.50432];
Model_3 = [0.91666,0.9375, 0.91666,0.6875, 0.41666,0.41666,0.40625,0.41666,0.36458,0.22916,0.22916,0.25,   0.40625,0.53125,0.625,  0.58333,0.35416,0.20833,0.20833,0.1875, 0.19791,0.1875, 0.1875, 0.1875, 0.1875,0.1875, 0.19791,0.22916,0.32291,0.50911,0.33108,0.38513,0.42567,0.39864,0.25675,0.29054,0.32432,0.34459,0.34459,0.35811,0.37162,0.39864,0.42567,0.44594,0.45945,0.47297,0.49324,0.5,    0.52702,0.46756];
Model_4 = [0.22093,0.24418,0.27906,0.31395,0.33720,0.36046,0.39534,0.41860,0.45348,0.45348,0.45348,0.45348,0.43023,0.44186,0.45348,0.44186,0.44186,0.44186,0.44186,0.44186,0.44186,0.44186,0.43023,0.75581,1,     1,      1,      0.61627,0.20930,0.32421,0.12666,0.17333,0.21333,0.26,   0.3    ,0.32666,0.31333,0.32666,0.32,   0.32,   0.32666,0.36,   0.43333,0.43333,0.74666,1,      1,      1,      1,      0.208];
Model_5 = [0.84091,0.86363,0.86363,0.85227,0.21590,0.20454,0.20454,0.20454,0.20454,0.20454,0.32954,0.65909,0.77272,0.82954,0.65909,0.47727,0.38636,0.30681,0.21590,0.20454,0.20454,0.19318,0.18181,0.18181,0.1818,0.18181,0.18181,0.20454,0.20454,0.48863,0.35897,0.60256,0.60897,0.57692,0.53205,0.33974,0.30769,0.3141, 0.30128,0.29487,0.29487,0.30128,0.32051,0.33333,0.35256,0.37179,0.41025,0.50641,0.66025,0.43162];
Model_6 = [0.29787,0.51063,0.61702,0.63829,0.46808,0.40425,0.36171,0.26595,0.19148,0.17021,0.15957,0.17021,0.31914,0.57446,0.71276,0.79787,0.70212,0.57446,0.52127,0.45744,0.43617,0.41489,0.40425,0.39361,0.3829,0.37234,0.3617, 0.37234,0.38297,0.46136,0.33766,0.57792,0.70129,0.77922,0.77922,0.51948,0.42857,0.37662,0.33116,0.2987, 0.29221,0.27922,0.27922,0.2987, 0.32467,0.32467,0.36363,0.3961, 0.50649,0.46031];
Model_7 = [0.95238,1,      1,      0.73809,0.44047,0.44047,0.45238,0.45238,0.30952,0.22619,0.22619,0.21428,0.21428,0.22619,0.21428,0.21428,0.20238,0.19047,0.20238,0.21428,0.20238,0.21428,0.21428,0.21428,0.2142,0.21428,0.21428,0.22619,0.21428,0.20308,0.21333,0.22666,0.22666,0.22666,0.16,   0.15333,0.28,   0.39333,0.48,   0.51333,0.46666,0.44666,0.40666,0.38666,0.36666,0.35333,0.36666,0.31333,0.26666,0.17666];
Model_8 = [0.34693,0.5102, 0.62244,0.59183,0.40816,0.35714,0.31632,0.30612,0.30612,0.28571,0.30612,0.31632,0.33673,0.38775,0.42857,0.62244,0.61224,0.53061,0.5102, 0.61224,0.71428,0.5,    0.41836,0.38775,0.3469,0.33673,0.35714,0.32653,0.32653,0.46079,0.16233,0.36363,0.55194,0.70779,0.66233,0.51948,0.46103,0.42857,0.37012,0.36363,0.33116,0.32467,0.32467,0.32467,0.33766,0.38311,0.3961, 0.45454,0.51948,0.49232];
Model_9 = [0.25531,0.45744,0.57446,0.65957,0.53191,0.46808,0.41489,0.41489,0.38297,0.39361,0.38297,0.38297,0.38297,0.38297,0.38297,0.39361,0.39361,0.42553,0.44681,0.48936,0.51063,0.61702,0.75531,0.79787,0.7127,0.531911,0.2553,0.18085,0.17021,0.38857,0.20779,0.37662,0.51298,0.61688,0.58441,0.43506,0.38961,0.34415,0.31818,0.30519,0.2987, 0.2987, 0.2987 ,0.31168,0.32467,0.35714,0.38961,0.48701,0.64935,0.61616];
Model_10 =[0.31914,0.59574,0.68085,0.74468,0.65957,0.58511,0.56382,0.55319,0.55319,0.55319,0.55319,0.55319,0.55319,0.55319,0.55319,0.55319,0.553191489361702,0.553191489361702,0.553191489361702,0.553191489361702,0.553191489361702,0.553191489361702,0.553191489361702,0.553191489361702,0.553191489361702,0.553191489361702,0.553191489361702,0.553191489361702,0.553191489361702,0.604703247480403,0.974025974025974,0.987012987012987,0.987012987012987,0.987012987012987,0.480519480519481,0,0,0,0.357142857142857,0.818181818181818,0.896103896103896,0.941558441558442,0.967532467532468,0.253246753246753,0.214285714285714,0.194805194805195,0.194805194805195,0.220779220779221,0.253246753246753,0.831168831168831];

% 花色投影模板 R--红桃 B--黑桃 F--方片 M--梅花

A = imread('../images/B_10.JPG');

% 分辨数字
% 三个参数分别代表：行数，列数，RGB三值(彩色图像固定为3)
% 比例是调出来的 ^_^
[x,y,z] = size(A);
Number_Left_Top = A(1 : x/6, 1 : y/6, 1 : z);
% 图像二值化,反色
Number_BW = ~im2bw(rgb2gray(Number_Left_Top),0.5);
% 中值滤波去除椒盐噪声，[3,3]为窗口大小
Number_BW = medfilt2(Number_BW,[3,3]);
[L_x,L_y,L_z] = size(Number_BW);
% 自定义白色像素点个数,用于统计，确定边缘
WhiteDot = 8;
% 上边缘
top = 0;
for i=1 : L_x
    count = sum(sum(Number_BW(i : i,:)));
    if count > WhiteDot
        top=i;
        break;
    end
end
% 下边缘
bottom = 0;
for i=L_x : -1 : 1
    count = sum(sum(Number_BW(i : i,:)));
    if count > WhiteDot
        bottom=i;
        break;
    end
end
% 左边缘
left = 0;
for i=1 : L_y
    count = sum(sum(Number_BW(:,i : i)));
    if count > WhiteDot
        left=i;
        break;
    end
end
% 右边缘
right = 0;
for i=L_y : -1 : 1
    count = sum(sum(Number_BW(:,i : i)));
    if count > WhiteDot
        right=i;
        break;
    end
end
Number_BW = Number_BW(top : bottom, left : right);
[L_x,L_y,L_z] = size(Number_BW);

Number_Model = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
% 对X轴横向投影取30个点
Xdiv_count = 30;
Xdiv = floor(L_x/Xdiv_count);
Xwhite_sum = 0;   % 白色像素点总数
Xdot_sum = 0;   % 像素点总数
x_start = 0;
x_end = 0;
for i=1 : Xdiv_count
    x_start = 1+Xdiv*(i-1);
    if i == Xdiv_count      %最后一个区间
        x_end = L_x;
    else
        x_end = Xdiv*i;
    end
    Xwhite_sum = sum(sum(Number_BW(x_start : x_end,:)));
    Xdot_sum = (x_end - x_start + 1)*L_y;
    Number_Model(i) = Xwhite_sum/Xdot_sum;
end
% 对Y轴纵向投影取20个点
Ydiv_count = 20;
Ydiv = floor(L_y/Ydiv_count);
Ywhite_sum = 0;   % 白色像素点总数
Ydot_sum = 0;   % 像素点总数
y_start = 0;
y_end = 0;
for i=1 : Ydiv_count
    y_start = 1+Ydiv*(i-1);
    if i == Ydiv_count      %最后一个区间
        y_end = L_y;
    else
        y_end = Ydiv*i;
    end
    Ywhite_sum = sum(sum(Number_BW(:,y_start : y_end)));
    Ydot_sum = L_x*(y_end - y_start + 1);
    Number_Model(i+Xdiv_count) = Ywhite_sum/Ydot_sum;
end


subplot(2,2,1),imshow(A),title('源图像');
subplot(2,2,2),imshow(Number_BW),title('左上角数字二值化图像');
